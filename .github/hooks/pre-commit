#!/bin/bash

# Pre-commit hook for PulseStream
# High-speed quality gate: Linting -> Security -> Tests

echo "ğŸš€ Running quality gates before commit..."

# 1. Check for Linting (Fail Fast)
echo "ğŸ” Checking Ruby style with RuboCop..."
bundle exec rubocop
if [ $? -ne 0 ]; then
  echo "âŒ RuboCop found offenses. Commit aborted."
  exit 1
fi

# 2. Run the full CI suite (Brakeman, Audits, and Tests)
echo "ğŸ§ª Running full CI suite..."
bin/ci
if [ $? -ne 0 ]; then
  echo "âŒ CI failed. Please check the logs above. Commit aborted."
  exit 1
fi

echo "âœ… All checks passed! Proceeding with commit."
exit 0